---
import { ui } from "../i18n/ui";

const { lang = "es" } = Astro.props;
const t = ui[lang as keyof typeof ui];

const certificatesData = {
    es: [
        {
            name: "Diplomatura en Profesional Full-Stack Developer",
            url: "https://validator.centrodeelearning.com/validator/87162c6b-8b8b-403a-a659-ae23fe118b1f",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Formación integral cubriendo todo el ciclo de vida del desarrollo web. Dominio en la construcción de aplicaciones web dinámicas y responsivas utilizando el stack MERN y Angular. Habilidades sólidas en gestión de bases de datos (SQL & NoSQL), diseño de API RESTful y control de versiones con Git.",
            skills: [
                "React",
                "Node.js",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
        {
            name: "Desarrollo con NodeJS",
            url: "https://validator.centrodeelearning.com/validator/f214e681-09a6-4cc9-b2f8-ce318e6563bb",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Especialización en programación del lado del servidor usando el motor V8. Aprendizaje en la construcción de servicios backend escalables de alto rendimiento y APIs REST con Express.js. Competencia en programación asíncrona, arquitectura basada en eventos y manejo de bases de datos no relacionales como MongoDB.",
            skills: [
                "Node.js",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
        {
            name: "Desarrollo en REACTJS",
            url: "https://validator.centrodeelearning.com/validator/1bfa6cfc-0510-4eca-b69b-690e94461416",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Enfoque en la construcción de Single Page Applications (SPAs) modernas e interactivas. Dominio de la arquitectura basada en componentes, Virtual DOM y gestión de estado usando Hooks y Redux. Integración de APIs externas y optimización del rendimiento de aplicaciones.",
            skills: [
                "React",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
        {
            name: "Desarrollo con Angular",
            url: "https://validator.centrodeelearning.com/validator/b6b799b1-0f97-408a-b325-9d88edc2c42e",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Habilidades en la construcción de aplicaciones web robustas de nivel empresarial usando el framework Angular de Google y TypeScript. Inyección de dependencias, arquitectura modular y formularios reactivos. Implementación de enrutamiento eficiente y gestión de estado complejo.",
            skills: [
                "Angular",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
    ],
    en: [
        {
            name: "Full-Stack Developer Professional Diploma",
            url: "https://validator.centrodeelearning.com/validator/87162c6b-8b8b-403a-a659-ae23fe118b1f",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Comprehensive training covering the entire web development lifecycle. Mastered building dynamic, responsive web applications using both the MERN stack and Angular. Acquired solid skills in database management (SQL & NoSQL), RESTful API design, and version control with Git.",
            skills: [
                "React",
                "Node.js",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
        {
            name: "NodeJS Development",
            url: "https://validator.centrodeelearning.com/validator/f214e681-09a6-4cc9-b2f8-ce318e6563bb",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Specialized in server-side programming using the V8 engine. Learned to build scalable, high-performance backend services and REST APIs with Express.js. Gained proficiency in asynchronous programming, event-driven architecture, and managing non-relational databases like MongoDB.",
            skills: [
                "Node.js",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
        {
            name: "REACTJS Development",
            url: "https://validator.centrodeelearning.com/validator/1bfa6cfc-0510-4eca-b69b-690e94461416",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Focused on building modern, interactive Single Page Applications (SPAs). Mastered the component-based architecture, Virtual DOM, and state management using Hooks and Redux. Learned to integrate external APIs and optimize application performance for a seamless user experience.",
            skills: [
                "React",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
        {
            name: "Angular Development",
            url: "https://validator.centrodeelearning.com/validator/b6b799b1-0f97-408a-b325-9d88edc2c42e",
            img: "https://validator.centrodeelearning.com/favicon.jpg",
            date: "2025",
            institution: "UTN FRBA",
            description:
                "Acquired skills in building robust, enterprise-grade web applications using Google's Angular framework and TypeScript. Covered dependency injection, modular architecture, and reactive forms. Learned to implement efficient routing and manage complex state for scalable front-end solutions",
            skills: [
                "Angular",
                "JavaScript (ES6+)",
                "Database Architecture",
                "Git",
                "RESTf API",
                "HTML5",
                "CSS3",
            ],
        },
    ],
};

const certificates =
    certificatesData[lang as keyof typeof certificatesData] ||
    certificatesData.es;
---

<div class="certificates-section">
    <div class="certificates-header">
        <h3>{t["certificates.title"]}</h3>
        <p>{t["certificates.subtitle"]}</p>
    </div>

    <div class="certificates-grid">
        {
            certificates.map((certificate) => (
                <div class="certificate-card">
                    <div class="card-content">
                        <a
                            href={certificate.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="card-link"
                        >
                            <span class="sr-only">View Certificate</span>
                        </a>
                        <div class="card-header">
                            <div class="icon-box">
                                <img
                                    src={certificate.img}
                                    alt="Institution Logo"
                                />
                            </div>
                            <div class="meta">
                                <span class="institution">
                                    {certificate.institution}
                                </span>
                                <span class="date">{certificate.date}</span>
                            </div>
                        </div>

                        <h4>{certificate.name}</h4>

                        <div class="description-container">
                            <p class="description">{certificate.description}</p>
                            <button
                                class="read-more-btn"
                                aria-label="Toggle description"
                                data-text-more={t["certificates.read_more"]}
                                data-text-less={t["certificates.show_less"]}
                            >
                                {t["certificates.read_more"]}
                            </button>
                        </div>

                        <div class="skills-tags">
                            {certificate.skills.slice(0, 4).map((skill) => (
                                <span class="tag">{skill}</span>
                            ))}
                            {certificate.skills.length > 4 && (
                                <>
                                    <button
                                        class="tag expand-trigger"
                                        aria-label={
                                            t["certificates.show_more_skills"]
                                        }
                                        data-count={
                                            certificate.skills.length - 4
                                        }
                                        data-label-more={
                                            t["certificates.show_more_skills"]
                                        }
                                        data-label-less={
                                            t["certificates.show_less_skills"]
                                        }
                                    >
                                        +{certificate.skills.length - 4}
                                    </button>
                                    {certificate.skills
                                        .slice(4)
                                        .map((skill) => (
                                            <span
                                                class="tag hidden-tag"
                                                style="display: none;"
                                            >
                                                {skill}
                                            </span>
                                        ))}
                                </>
                            )}
                        </div>
                    </div>
                    <div class="shine" />
                </div>
            ))
        }
    </div>
</div>

<script>
    document.addEventListener("astro:page-load", () => {
        setupInteractions();
    });

    document.addEventListener("DOMContentLoaded", () => {
        setupInteractions();
    });

    function setupInteractions() {
        // Skills Expander
        const triggers = document.querySelectorAll(".expand-trigger");
        triggers.forEach((trigger) => {
            trigger.addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();

                const parent = trigger.parentElement;
                if (!parent) return;

                const hiddenTags = parent.querySelectorAll(".hidden-tag");
                const isExpanded =
                    trigger.getAttribute("data-expanded") === "true";
                const originalCount = trigger.getAttribute("data-count");
                const labelMore =
                    trigger.getAttribute("data-label-more") ||
                    "Show more skills";
                const labelLess =
                    trigger.getAttribute("data-label-less") ||
                    "Show less skills";

                if (!isExpanded) {
                    // Expand
                    hiddenTags.forEach((tag) => {
                        (tag as HTMLElement).style.display = "inline-block";
                        tag.classList.add("animate-in");
                    });
                    trigger.textContent = "-";
                    trigger.setAttribute("data-expanded", "true");
                    trigger.setAttribute("aria-label", labelLess);
                    (trigger as HTMLElement).style.order = "999"; // Move to end
                } else {
                    // Collapse
                    hiddenTags.forEach((tag) => {
                        (tag as HTMLElement).style.display = "none";
                        tag.classList.remove("animate-in");
                    });
                    trigger.textContent = "+" + originalCount;
                    trigger.setAttribute("data-expanded", "false");
                    trigger.setAttribute("aria-label", labelMore);
                    (trigger as HTMLElement).style.order = "0"; // Restore position
                }
            });
        });

        // Description Read More
        const descBtns = document.querySelectorAll(".read-more-btn");
        descBtns.forEach((btn) => {
            btn.addEventListener("click", (e) => {
                e.preventDefault();
                e.stopPropagation();

                const container = btn.parentElement;
                const desc = container?.querySelector(".description");
                const textMore =
                    btn.getAttribute("data-text-more") || "Read more";
                const textLess =
                    btn.getAttribute("data-text-less") || "Show less";

                if (container && desc) {
                    container.classList.toggle("expanded");
                    if (container.classList.contains("expanded")) {
                        btn.textContent = textLess;
                    } else {
                        btn.textContent = textMore;
                    }
                }
            });
        });
    }
</script>

<style>
    .certificates-section {
        margin-top: 4rem;
    }

    .certificates-header {
        margin-bottom: 2rem;
        text-align: center;
    }

    .certificates-header h3 {
        font-size: 2rem;
        color: var(--accent-color);
        margin-bottom: 0.5rem;
    }

    .certificates-header p {
        color: var(--text-color);
        opacity: 0.7;
        font-size: 1rem;
    }

    .certificates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .certificate-card {
        background: var(--secondary-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    [data-theme="light"] .certificate-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fc 100%);
        border: 1px solid #e1e4e8;
        box-shadow:
            0 2px 8px rgba(0, 0, 0, 0.04),
            0 1px 3px rgba(169, 143, 143, 0.06);
    }

    [data-theme="light"] .certificate-card:hover {
        box-shadow:
            0 8px 20px rgba(9, 105, 218, 0.12),
            0 3px 6px rgba(9, 105, 218, 0.08);
        border-color: #0969da;
    }

    .card-link {
        position: absolute;
        inset: 0;
        z-index: 1;
        cursor: pointer;
    }

    .skills-tags,
    .description-container {
        position: relative;
        z-index: 2;
        pointer-events: none;
    }

    .tag,
    .read-more-btn {
        pointer-events: auto;
    }

    .certificate-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent-color);
        box-shadow: 0 10px 30px -10px rgba(88, 166, 255, 0.2);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .icon-box {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5px;
    }

    [data-theme="light"] .icon-box {
        background: linear-gradient(135deg, #f0f4ff 0%, #e6efff 100%);
        border: 1px solid #c8d9f7;
    }

    .icon-box img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 4px;
    }

    .meta {
        display: flex;
        flex-direction: column;
    }

    .institution {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-color);
    }

    .date {
        font-size: 0.8rem;
        color: var(--text-color);
        opacity: 0.6;
    }

    h4 {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-color);
        margin-bottom: 0.8rem;
        line-height: 1.4;
    }

    .description-container {
        margin-bottom: 1.5rem;
    }

    .description {
        font-size: 0.95rem;
        color: var(--text-color);
        opacity: 0.8;
        line-height: 1.6;

        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .description-container.expanded .description {
        -webkit-line-clamp: unset;
    }

    .read-more-btn {
        background: none;
        border: none;
        color: var(--accent-color);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        padding: 0;
        margin-top: 5px;
        background-color: transparent;
    }

    .read-more-btn:hover {
        text-decoration: underline;
    }

    .skills-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: auto;
    }

    .tag {
        font-size: 0.75rem;
        background: rgba(88, 166, 255, 0.1);
        color: var(--accent-color);
        padding: 0.2rem 0.6rem;
        border-radius: 20px;
        font-weight: 500;
        border: 1px solid rgba(88, 166, 255, 0.2);
    }

    [data-theme="light"] .tag {
        background: linear-gradient(135deg, #f0f6ff 0%, #e6f0ff 100%);
        color: #0550ae;
        border: 1px solid #c8daf7;
        font-weight: 600;
    }

    .expand-trigger {
        cursor: pointer;
        padding: 0.2rem 0.6rem;
        font-family: inherit;
        line-height: inherit;
        transition: all 0.2s;
    }

    .expand-trigger:hover {
        background: rgba(88, 166, 255, 0.25);
        transform: scale(1.05);
    }

    [data-theme="light"] .expand-trigger:hover {
        background: linear-gradient(135deg, #d9e6ff 0%, #ccdeff 100%);
        border-color: #a8c7fa;
    }

    .animate-in {
        animation: fadeInTag 0.3s ease forwards;
    }

    @keyframes fadeInTag {
        from {
            opacity: 0;
            transform: translateY(5px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    .shine {
        position: absolute;
        top: 0;
        left: -100%;
        width: 50%;
        height: 100%;
        background: linear-gradient(
            to right,
            transparent,
            rgba(255, 255, 255, 0.05),
            transparent
        );
        transform: skewX(-25deg);
        transition: 0.5s;
        pointer-events: none;
    }

    [data-theme="light"] .shine {
        background: linear-gradient(
            to right,
            transparent,
            rgba(88, 166, 255, 0.15),
            transparent
        );
    }

    .certificate-card:hover .shine {
        left: 100%;
        transition: 0.5s;
    }

    @media (max-width: 600px) {
        .certificates-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
